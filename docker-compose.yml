services:
  burndown:
    build: ./scripts/burndown
    volumes:
      - ${BURNDOWN_DATA:-./burndown}:/data
    environment:
      INPUT: /data/data.csv
      OUTPUT: /data/plot.svg
      GH_TOKEN: ${GH_TOKEN:-lol}

  emulator:
    image: docker.io/budtmo/docker-android:emulator_11.0
    ports:
      - "6080:6080"
    environment:
      EMULATOR_DEVICE: "Samsung Galaxy S10"
      WEB_VNC: true
      APPIUM: true
    devices:
      - /dev/kvm
    volumes:
      - apk:/apk:ro
  build-apk:
    build: ./frontend
    volumes:
      - apk:/app/build/app/outputs/flutter-apk
  acceptance-tests:
    build: ./test
    environment:
      APPIUM_OS: android
      APK: /apk/app-debug.apk
      DEVICE: ''
      APPIUM_HOST: "emulator"
      APPIUM_PORT: "4723"

  # the .env should be created manually by each of you in backend/server_db/.env
  # command to run just postgres: docker-compose --env-file backend/server_db/.env up -d postgres 
  postgres: 
    image: postgres
    environment:
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-password}
    volumes:
      - ./backend/server_db/sql_scripts:/docker-entrypoint-initdb.d
      - ./backend/server_db/data:/var/lib/postgresql/data
      - ./backend/server_db/migrations:/migrations 
    network_mode: host
  backend:
    build: ./backend
    ports:
      - "5000:5000"

volumes:
  apk: